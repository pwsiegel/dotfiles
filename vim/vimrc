" Plugins (via plugged)
call plug#begin('~/.vim/plugged')
Plug 'tpope/vim-sensible'
Plug 'tpope/vim-fugitive'
Plug 'tpope/vim-repeat'
Plug 'tpope/vim-unimpaired'
Plug 'tpope/vim-surround'
Plug 'altercation/vim-colors-solarized'
Plug 'scrooloose/nerdtree'
Plug 'ctrlpvim/ctrlp.vim'
Plug 'ervandew/supertab'
Plug 'jiangmiao/auto-pairs'
Plug 'vim-syntastic/syntastic'
Plug 'davidhalter/jedi-vim'
Plug 'lambdalisue/vim-pyenv'
Plug 'Vimjas/vim-python-pep8-indent'
Plug 'PProvost/vim-markdown-jekyll'
call plug#end()

" Basic Settings
filetype on
syntax on
set background=dark
" let g:solarized_termcolors=256
colorscheme solarized
set wildignore=*.pyc
set visualbell
set noerrorbells
set colorcolumn=80
set number
set hlsearch
set clipboard^=unnamed " Requires vim to be compiled with +clipboard option

" Indentation
set tabstop=4
set shiftwidth=4
set softtabstop=4
set expandtab

" Disable arrow keys 
map <up> <nop>
map <down> <nop>
map <left> <nop>
map <right> <nop>

" Status bar
set laststatus=2
set statusline=%f
set statusline+=%=
set statusline+=%{fugitive#statusline()}
set statusline+=\ -
set statusline+=\ %l/%L

" Mappings
let mapleader=" "
map <leader>s :source ~/.vim/vimrc<CR>:nohls<CR>
map <leader>gs :Gstatus<CR>
map <leader>h :nohls<CR>
noremap <C-l> :tabn<CR>
noremap <C-h> :tabp<CR>
set pastetoggle=<leader>p

" Nerdtree Settings
autocmd StdinReadPre * let s:std_in=1
autocmd VimEnter * if argc() == 0 && !exists("s:std_in") | NERDTree | endif
map <C-n> :NERDTreeToggle<CR>

" Syntastic Settings
let g:syntastic_mode_map = {"mode": "passive"}
let g:syntastic_always_populate_loc_list = 1
let g:syntastic_auto_loc_list = 1
let g:syntastic_check_on_wq = 0
command! Synerr let g:syntastic_quiet_messages = {"!level": "errors"} | SyntasticCheck
command! Synall let g:syntastic_quiet_messages = {} | SyntasticCheck
command! Synoff SyntasticReset 

" Language specific

" Jekyll / Markdown / Mathjax
" TODO Figure out how to offload this into a separate file
autocmd BufRead,BufNewFile,BufEnter *.md,*.markdown set filetype=markdown

function! MathAndLiquid()
    "" Define certain regions
    " Block math. Look for "$$[anything]$$"
    syn region math start=/\$\$/ end=/\$\$/
    " inline math. Look for "$[not $][anything]$"
    syn match math_block '\$[^$].\{-}\$'

    " Liquid single line. Look for "{%[anything]%}"
    syn match liquid '{%.*%}'
    " Liquid multiline. Look for "{%[anything]%}[anything]{%[anything]%}"
    syn region highlight_block start='{% highlight .*%}' end='{%.*%}'
    " Fenced code blocks, used in GitHub Flavored Markdown (GFM)
    syn region highlight_block start='```' end='```'

    "" Actually highlight those regions.
    hi link math Statement
    hi link liquid Statement
    hi link highlight_block Function
    hi link math_block Function
endfunction

autocmd BufRead,BufNewFile,BufEnter *.md,*.markdown call MathAndLiquid()
